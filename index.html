<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Solara ç•™è¨€æ¿</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #loginForm, #messageForm { margin-bottom: 20px; }
    #messages { border-top: 1px solid #ccc; padding-top: 10px; }
    .message { margin-bottom: 10px; padding: 5px; border-bottom: 1px solid #eee; }
    .username { font-weight: bold; }
    .content { margin-left: 10px; }
  </style>
</head>
<body>

<h2>ç•™è¨€æ¿</h2>

<div id="loginForm">
  <input type="email" id="email" placeholder="é‚®ç®±">
  <input type="password" id="password" placeholder="å¯†ç ">
  <button id="loginBtn">ç™»å½•</button>
  <button id="registerBtn">æ³¨å†Œ</button>
</div>

<div id="messageForm" style="display:none;">
  <input type="text" id="content" placeholder="å†™ä¸‹ä½ çš„ç•™è¨€">
  <button id="sendBtn">å‘é€</button>
  <button id="logoutBtn">é€€å‡ºç™»å½•</button>
</div>

<div id="messages"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getFirestore, collection, addDoc, query, getDocs } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";

// ğŸ”¹ ä¿®æ”¹è¿™é‡Œä¸ºä½ çš„ Firebase é…ç½®
const firebaseConfig = {
  apiKey: "ä½ çš„APIKEY",
  authDomain: "ä½ çš„PROJECTID.firebaseapp.com",
  projectId: "ä½ çš„PROJECTID",
  storageBucket: "ä½ çš„PROJECTID.appspot.com",
  messagingSenderId: "ä½ çš„SENDERID",
  appId: "ä½ çš„APPID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const loginForm = document.getElementById('loginForm');
const messageForm = document.getElementById('messageForm');
const messagesDiv = document.getElementById('messages');

const emailInput = document.getElementById('email');
const passwordInput = document.getElementById('password');
const contentInput = document.getElementById('content');

const loginBtn = document.getElementById('loginBtn');
const registerBtn = document.getElementById('registerBtn');
const sendBtn = document.getElementById('sendBtn');
const logoutBtn = document.getElementById('logoutBtn');

// ç™»å½•
loginBtn.addEventListener('click', async () => {
  try {
    await signInWithEmailAndPassword(auth, emailInput.value, passwordInput.value);
    emailInput.value = '';
    passwordInput.value = '';
  } catch (e) {
    alert("ç™»å½•å¤±è´¥: " + e.message);
  }
});

// æ³¨å†Œ
registerBtn.addEventListener('click', async () => {
  try {
    await createUserWithEmailAndPassword(auth, emailInput.value, passwordInput.value);
    emailInput.value = '';
    passwordInput.value = '';
  } catch (e) {
    alert("æ³¨å†Œå¤±è´¥: " + e.message);
  }
});

// é€€å‡ºç™»å½•
logoutBtn.addEventListener('click', async () => {
  await signOut(auth);
});

// å‘é€ç•™è¨€
sendBtn.addEventListener('click', async () => {
  const user = auth.currentUser;
  const content = contentInput.value.trim();
  if (!content) return alert("ç•™è¨€ä¸èƒ½ä¸ºç©ºï¼");
  if (!user) return alert("æœªç™»å½•ï¼");
  await addDoc(collection(db, "messages"), {
    username: user.email,
    content: content
  });
  contentInput.value = '';
  loadMessages();
});

// ç›‘å¬ç™»å½•çŠ¶æ€
onAuthStateChanged(auth, user => {
  if (user) {
    loginForm.style.display = 'none';
    messageForm.style.display = 'block';
  } else {
    loginForm.style.display = 'block';
    messageForm.style.display = 'none';
  }
});

// åŠ è½½ç•™è¨€
async function loadMessages() {
  const q = query(collection(db, "messages"));
  const querySnapshot = await getDocs(q);
  messagesDiv.innerHTML = '';
  querySnapshot.forEach(doc => {
    const data = doc.data();
    const div = document.createElement('div');
    div.className = 'message';
    div.innerHTML = `<span class="username">${data.username}</span>: <span class="content">${data.content}</span>`;
    messagesDiv.appendChild(div);
  });
}

loadMessages();
</script>

</body>
</html>
