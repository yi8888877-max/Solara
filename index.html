<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Solara 留言板</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    #loginForm, #messageForm { margin-bottom: 20px; }
    #messages { border-top: 1px solid #ccc; padding-top: 10px; }
    .message { margin-bottom: 10px; padding: 5px; border-bottom: 1px solid #eee; }
    .username { font-weight: bold; }
    .content { margin-left: 10px; }
  </style>
</head>
<body>

<h2>留言板</h2>

<div id="loginForm">
  <input type="email" id="email" placeholder="邮箱">
  <input type="password" id="password" placeholder="密码">
  <button id="loginBtn">登录</button>
  <button id="registerBtn">注册</button>
</div>

<div id="messageForm" style="display:none;">
  <input type="text" id="content" placeholder="写下你的留言">
  <button id="sendBtn">发送</button>
  <button id="logoutBtn">退出登录</button>
</div>

<div id="messages"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getFirestore, collection, addDoc, query, getDocs } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-auth.js";

// 🔹 修改这里为你的 Firebase 配置
const firebaseConfig = {
  apiKey: "你的APIKEY",
  authDomain: "你的PROJECTID.firebaseapp.com",
  projectId: "你的PROJECTID",
  storageBucket: "你的PROJECTID.appspot.com",
  messagingSenderId: "你的SENDERID",
  appId: "你的APPID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

const loginForm = document.getElementById('loginForm');
const messageForm = document.getElementById('messageForm');
const messagesDiv = document.getElementById('messages');

const emailInput = document.getElementById('email');
const passwordInput = document.getElementById('password');
const contentInput = document.getElementById('content');

const loginBtn = document.getElementById('loginBtn');
const registerBtn = document.getElementById('registerBtn');
const sendBtn = document.getElementById('sendBtn');
const logoutBtn = document.getElementById('logoutBtn');

// 登录
loginBtn.addEventListener('click', async () => {
  try {
    await signInWithEmailAndPassword(auth, emailInput.value, passwordInput.value);
    emailInput.value = '';
    passwordInput.value = '';
  } catch (e) {
    alert("登录失败: " + e.message);
  }
});

// 注册
registerBtn.addEventListener('click', async () => {
  try {
    await createUserWithEmailAndPassword(auth, emailInput.value, passwordInput.value);
    emailInput.value = '';
    passwordInput.value = '';
  } catch (e) {
    alert("注册失败: " + e.message);
  }
});

// 退出登录
logoutBtn.addEventListener('click', async () => {
  await signOut(auth);
});

// 发送留言
sendBtn.addEventListener('click', async () => {
  const user = auth.currentUser;
  const content = contentInput.value.trim();
  if (!content) return alert("留言不能为空！");
  if (!user) return alert("未登录！");
  await addDoc(collection(db, "messages"), {
    username: user.email,
    content: content
  });
  contentInput.value = '';
  loadMessages();
});

// 监听登录状态
onAuthStateChanged(auth, user => {
  if (user) {
    loginForm.style.display = 'none';
    messageForm.style.display = 'block';
  } else {
    loginForm.style.display = 'block';
    messageForm.style.display = 'none';
  }
});

// 加载留言
async function loadMessages() {
  const q = query(collection(db, "messages"));
  const querySnapshot = await getDocs(q);
  messagesDiv.innerHTML = '';
  querySnapshot.forEach(doc => {
    const data = doc.data();
    const div = document.createElement('div');
    div.className = 'message';
    div.innerHTML = `<span class="username">${data.username}</span>: <span class="content">${data.content}</span>`;
    messagesDiv.appendChild(div);
  });
}

loadMessages();
</script>

</body>
</html>
